


```{r}
rm(list = ls())
chart = read.csv("train_Madison.csv", header = TRUE)

chart
rawdata = chart[c(2, 7:508)]
model1 = lm(star ~ ., data = rawdata)
#summary(model1)
trim = which(summary(model1)$coefficients[,4] < 1)
model2 = lm(star ~ ., data = rawdata[trim])
#summary(model2)
trim = trim[-1]
trim = trim - 1
trim

test_data = read.csv("test_Madison.csv", header = TRUE)
test_rawdata = test_data[6:507]
coeff = summary(model2)$coefficients[-1,1]
test_trim = test_rawdata[trim]
data.matrix(test_trim)

fit_data = data.matrix(test_trim) %*% data.matrix(coeff)
fit_data = fit_data + summary(model2)$coefficients[1,1]
fit_data[fit_data > 5] = 5
fit_data[fit_data < 1] = 1
result = as.data.frame(test_data[,1])
colnames(result)[1] = "Id"
result
result$Expected = fit_data
result
write.csv(result, "test_result.csv", row.names = FALSE)
```

```{r}
yhat = predict(model2)
yhat[yhat > 5] = 5
yhat[yhat < 1] = 1
resid = rawdata$star - yhat
plot(chart$Id, resid, xlab = "ID", ylab = "Residuals", main = "Residual Plot",pch = 23,bg = "red",cex = 1.2)
abline(a = 0, b = 0, col = "black", lwd = 3)
sortResid = sort(abs(resid), decreasing = TRUE)
Outlier = sortResid[1:100]
Outlier
```

```{r}
l<-rep(0, 502) #cor of each predictor with star
no_text_data = chart[,9:508]
for (i in 1:500){
  l[i] = cor(chart$star, no_text_data[,i])
}

order(l[1:500])
most = names(no_text_data[order(l[1:500]) < 51])
least = names(no_text_data[order(l[1:500]) > 451])

most_sum = apply(no_text_data[,most], MARGIN = 1, FUN = sum)
chart$most_sum = most_sum
least_sum = apply(no_text_data[,least], MARGIN = 1, FUN = sum)
chart$least_sum = least_sum
```

```{r}
par(mfrow = c(1,2))
hist(resid, breaks = 100, main="Histogram of Residuals", xlab = "Residuals")
plot(density(resid), main="Kernel Density of Residuals", xlab = "Residuals")
```

